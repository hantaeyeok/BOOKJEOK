<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kh.bookjeok.cart.model.dao.CartMapper">

    <!-- 장바구니 항목 추가 -->
    <insert id="addToCart" parameterType="map">
        INSERT INTO CART (
            CART_NO,
            BOOK_NO,
            USER_ID,
            CART_TOTAL,
            CART_AMOUNT 
        ) VALUES (
            CART_SEQ.NEXTVAL,
            #{bookNo},
            #{userId},
            #{cartTotal},
            #{cartAmount}
        )
    </insert>

    <!-- 장바구니 항목 업데이트 -->
    <update id="updateCartQuantity" parameterType="cart">
        UPDATE CART
        SET CART_AMOUNT = #{cartAmount}
        WHERE USER_ID = #{userId}
        AND BOOK_NO = #{bookNo}
    </update>

    <!-- 장바구니 항목 삭제 -->
    <delete id="deleteFromCart" parameterType="map">
        DELETE FROM CART
        WHERE USER_ID = #{userId}
        AND BOOK_NO = #{bookNo}
    </delete>

    <!-- 장바구니 항목 조회 -->
    <select id="selectCartItems" parameterType="string" resultType="cart">
        SELECT 
            CART_NO cartNo,
            BOOK_NO bookNo,
            USER_ID userId,
            CART_TOTAL cartTotal,
            CART_AMOUNT cartAmount
        FROM 
            CART
        WHERE 
            USER_ID = #{userId}
    </select>

    <!-- 특정 장바구니 항목 조회 -->
    <select id="selectCartItem" parameterType="map" resultType="cart">
        SELECT 
            CART_NO cartNo,
            BOOK_NO bookNo,
            USER_ID userId,
            CART_TOTAL cartTotal,
            CART_AMOUNT cartAmount
        FROM 
            CART
        WHERE 
            USER_ID = #{userId}
        AND 
            BOOK_NO = #{bookNo}
    </select>

    <!-- 장바구니 항목 병합 -->
    <update id="mergeCart" parameterType="map">
        UPDATE 
        		CART
        SET 
        		USER_ID = #{newUserId}
        WHERE 
        		USER_ID = #{tempUserId}
    </update>

	<!-- 구매 성공하면 지워야할 구문이에요 -->
    <!-- 장바구니 항목 구매 -->
    <delete id="purchaseItems" parameterType="map">
        DELETE 
        FROM 
        		CART
        WHERE 
        		USER_ID = #{userId}
        AND 
        		BOOK_NO = #{bookNo}
    </delete>

</mapper>
